import{a as ht,b as mt}from"./chunk-KTCWHJZF.js";import{a as pt}from"./chunk-RNBGJWSO.js";import{a as se}from"./chunk-UQIJAAKI.js";import"./chunk-N5GVGQ4K.js";import"./chunk-J6TDGA35.js";import"./chunk-QUJFQN2Y.js";import"./chunk-7SZ5I7WP.js";import"./chunk-ACCAO4MD.js";import"./chunk-5JK572SR.js";import"./chunk-Q6ZAM2NN.js";import"./chunk-D4FXQO5S.js";import"./chunk-DQ5ZCVVT.js";import"./chunk-IACAUHTZ.js";import"./chunk-3PBEGTIV.js";import"./chunk-7IJ7AO6C.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-KIHU62J2.js";import"./chunk-CKP3SGE2.js";import"./chunk-QWR7HY4T.js";import{A as at,B as st,b as et,c as _e,e as te,f as ie,i as ne,m as re,n as tt,o as it,p as nt,s as rt,v as ot,w as oe}from"./chunk-GVFFSMFN.js";import"./chunk-JAJGNRWB.js";import{Aa as Ke,Ab as Ze,B as H,F as W,G as Ee,J as ue,K as j,L as X,P as M,Q as p,R as d,S as x,T as He,U as We,Y as O,Z as f,_ as l,a as Pe,c as A,ca as L,d as de,da as D,e as Ve,ea as B,f as ge,fa as q,ga as ee,ha as P,ja as fe,k as S,lb as xe,mb as je,n as h,nb as Xe,o as m,ob as Ye,qa as V,qb as Qe,r as K,ra as Le,s as Fe,sb as Ne,ta as De,tb as Ge,ub as $e,w as Ae,x as Ue,xa as Be,y as C,ya as qe,z as ke,zb as Je}from"./chunk-LTL7P2HV.js";import{a as ae,b as ct,c as lt}from"./chunk-EULJA4UZ.js";import"./chunk-EQMUS7GP.js";import"./chunk-G4GOZ2R2.js";import"./chunk-G3OIN57Y.js";import"./chunk-6YG4V6SN.js";import"./chunk-AH6ETBBK.js";import"./chunk-FKHQKLCL.js";import"./chunk-EGVB773T.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-LRFGNCHE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as _,b as T,j as u}from"./chunk-VI73JOY6.js";var F=function(o){return o.Prompt="PROMPT",o.Camera="CAMERA",o.Photos="PHOTOS",o}(F||{}),Y=function(o){return o.Rear="REAR",o.Front="FRONT",o}(Y||{}),Ce=function(o){return o.Uri="uri",o.Base64="base64",o.DataUrl="dataUrl",o}(Ce||{});var Q=class extends lt{getPhoto(e){return u(this,null,function*(){return new Promise((n,t)=>u(this,null,function*(){if(e.webUseInput||e.source===F.Photos)this.fileInputExperience(e,n,t);else if(e.source===F.Prompt){let i=document.querySelector("pwa-action-sheet");i||(i=document.createElement("pwa-action-sheet"),document.body.appendChild(i)),i.header=e.promptLabelHeader||"Photo",i.cancelable=!1,i.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],i.addEventListener("onSelection",r=>u(this,null,function*(){r.detail===0?this.fileInputExperience(e,n,t):this.cameraExperience(e,n,t)}))}else this.cameraExperience(e,n,t)}))})}pickImages(e){return u(this,null,function*(){return new Promise((n,t)=>u(this,null,function*(){this.multipleFileInputExperience(n,t)}))})}cameraExperience(e,n,t){return u(this,null,function*(){if(customElements.get("pwa-camera-modal")){let i=document.createElement("pwa-camera-modal");i.facingMode=e.direction===Y.Front?"user":"environment",document.body.appendChild(i);try{yield i.componentOnReady(),i.addEventListener("onPhoto",r=>u(this,null,function*(){let a=r.detail;a===null?t(new ae("User cancelled photos app")):a instanceof Error?t(a):n(yield this._getCameraPhoto(a,e)),i.dismiss(),document.body.removeChild(i)})),i.present()}catch{this.fileInputExperience(e,n,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,n,t)})}fileInputExperience(e,n,t){let i=document.querySelector("#_capacitor-camera-input"),r=()=>{var a;(a=i.parentNode)===null||a===void 0||a.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",a=>{let s=i.files[0],c="jpeg";if(s.type==="image/png"?c="png":s.type==="image/gif"&&(c="gif"),e.resultType==="dataUrl"||e.resultType==="base64"){let g=new FileReader;g.addEventListener("load",()=>{if(e.resultType==="dataUrl")n({dataUrl:g.result,format:c});else if(e.resultType==="base64"){let z=g.result.split(",")[1];n({base64String:z,format:c})}r()}),g.readAsDataURL(s)}else n({webPath:URL.createObjectURL(s),format:c}),r()}),i.addEventListener("cancel",a=>{t(new ae("User cancelled photos app")),r()})),i.accept="image/*",i.capture=!0,e.source===F.Photos||e.source===F.Prompt?i.removeAttribute("capture"):e.direction===Y.Front?i.capture="user":e.direction===Y.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(e,n){let t=document.querySelector("#_capacitor-camera-input-multiple"),i=()=>{var r;(r=t.parentNode)===null||r===void 0||r.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",r=>{let a=[];for(let s=0;s<t.files.length;s++){let c=t.files[s],g="jpeg";c.type==="image/png"?g="png":c.type==="image/gif"&&(g="gif"),a.push({webPath:URL.createObjectURL(c),format:g})}e({photos:a}),i()}),t.addEventListener("cancel",r=>{n(new ae("User cancelled photos app")),i()})),t.accept="image/*",t.click()}_getCameraPhoto(e,n){return new Promise((t,i)=>{let r=new FileReader,a=e.type.split("/")[1];n.resultType==="uri"?t({webPath:URL.createObjectURL(e),format:a,saved:!1}):(r.readAsDataURL(e),r.onloadend=()=>{let s=r.result;n.resultType==="dataUrl"?t({dataUrl:s,format:a,saved:!1}):t({base64String:s.split(",")[1],format:a,saved:!1})},r.onerror=s=>{i(s)})})}checkPermissions(){return u(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return u(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return u(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return u(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},Nt=new Q;var dt=ct("Camera",{web:()=>new Q});var bt=["wrapper"],vt=["sourceImage"];function It(o,e){if(o&1){let n=O();p(0,"img",5,0),f("load",function(){h(n);let i=l();return m(i.imageLoadedInView())})("mousedown",function(i){h(n);let r=l();return m(r.startMove(i,r.moveTypes.Drag))})("touchstart",function(i){h(n);let r=l();return m(r.startMove(i,r.moveTypes.Drag))})("error",function(i){h(n);let r=l();return m(r.loadImageError(i))}),d()}if(o&2){let n=e.ngIf,t=l();q("visibility",t.imageVisible?"visible":"hidden")("transform",t.safeTransformStyle()),ee("ngx-ic-draggable",!t.disabled&&t.allowMoveImage),M("src",n,Ae),ue("alt",t.imageAltText)}}function zt(o,e){if(o&1){let n=O();He(0),p(1,"span",9),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"topleft"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"topleft"))}),x(2,"span",10),d(),p(3,"span",11),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"topright"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"topright"))}),x(4,"span",10),d(),p(5,"span",12),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottomright"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottomright"))}),x(6,"span",10),d(),p(7,"span",13),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottomleft"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottomleft"))}),x(8,"span",10),d(),p(9,"span",14),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"top"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"top"))}),d(),p(10,"span",15),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"top"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"top"))}),x(11,"span",10),d(),p(12,"span",16),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"right"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"right"))}),d(),p(13,"span",17),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"right"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"right"))}),x(14,"span",10),d(),p(15,"span",18),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottom"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottom"))}),d(),p(16,"span",19),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottom"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"bottom"))}),x(17,"span",10),d(),p(18,"span",20),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"left"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"left"))}),d(),p(19,"span",21),f("mousedown",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"left"))})("touchstart",function(i){h(n);let r=l(2);return m(r.startMove(i,r.moveTypes.Resize,"left"))}),x(20,"span",10),d(),We()}}function Rt(o,e){if(o&1){let n=O();p(0,"div",6),f("keydown",function(i){h(n);let r=l();return m(r.keyboardAccess(i))}),p(1,"div",7),f("mousedown",function(i){h(n);let r=l();return m(r.startMove(i,r.moveTypes.Move))})("touchstart",function(i){h(n);let r=l();return m(r.startMove(i,r.moveTypes.Move))}),d(),W(2,zt,21,0,"ng-container",8),d()}if(o&2){let n=l();q("top",n.state.cropper().y1,"px")("left",n.state.cropper().x1,"px")("width",n.state.cropper().x2-n.state.cropper().x1,"px")("height",n.state.cropper().y2-n.state.cropper().y1,"px")("margin-left",n.state.options.alignImage==="center"?n.marginLeft:null)("visibility",n.imageVisible?"visible":"hidden"),ee("ngx-ic-round",n.state.options.roundCropper),ue("aria-label",n.state.options.cropperFrameAriaLabel),C(2),M("ngIf",!n.state.options.hideResizeSquares&&!(n.state.options.cropperStaticWidth&&n.state.options.cropperStaticHeight))}}function N(o,e,n){return o=Tt(o,e),ce(o,e,n)}function Tt(o,e){let n=o.x2-o.x1,t=o.y2-o.y1,i=o.x1+n/2,r=o.y1+t/2;e.options.cropperStaticHeight&&e.options.cropperStaticWidth?(n=e.maxSize().width>e.options.cropperStaticWidth?e.options.cropperStaticWidth:e.maxSize().width,t=e.maxSize().height>e.options.cropperStaticHeight?e.options.cropperStaticHeight:e.maxSize().height):(n=Math.max(e.cropperScaledMinWidth,Math.min(n,e.cropperScaledMaxWidth,e.maxSize().width)),t=Math.max(e.cropperScaledMinHeight,Math.min(t,e.cropperScaledMaxHeight,e.maxSize().height)),e.options.maintainAspectRatio&&(e.maxSize().width/e.options.aspectRatio<e.maxSize().height?t=n/e.options.aspectRatio:n=t*e.options.aspectRatio));let a=i-n/2,s=a+n,c=r-t/2,g=c+t;return{x1:a,x2:s,y1:c,y2:g}}function ce(o,e,n=!1){return o.x1<0&&(o=T(_({},o),{x1:0,x2:o.x2-(n?o.x1:0)})),o.y1<0&&(o=T(_({},o),{y2:o.y2-(n?o.y1:0),y1:0})),o.x2>e.maxSize().width&&(o=T(_({},o),{x1:o.x1-(n?o.x2-e.maxSize().width:0),x2:e.maxSize().width})),o.y2>e.maxSize().height&&(o=T(_({},o),{y1:o.y1-(n?o.y2-e.maxSize().height:0),y2:e.maxSize().height})),o}function St(o,e){let n=le(o)-e.clientX,t=he(o)-e.clientY;return{x1:e.cropper.x1+n,y1:e.cropper.y1+t,x2:e.cropper.x2+n,y2:e.cropper.y2+t}}function gt(o,e,n){let t=_({},n.cropper()),i=le(o)-e.clientX,r=he(o)-e.clientY;switch(e.position){case"left":t.x1=Math.min(Math.max(e.cropper.x1+i,t.x2-n.cropperScaledMaxWidth),t.x2-n.cropperScaledMinWidth);break;case"topleft":t.x1=Math.min(Math.max(e.cropper.x1+i,t.x2-n.cropperScaledMaxWidth),t.x2-n.cropperScaledMinWidth),t.y1=Math.min(Math.max(e.cropper.y1+r,t.y2-n.cropperScaledMaxHeight),t.y2-n.cropperScaledMinHeight);break;case"top":t.y1=Math.min(Math.max(e.cropper.y1+r,t.y2-n.cropperScaledMaxHeight),t.y2-n.cropperScaledMinHeight);break;case"topright":t.x2=Math.max(Math.min(e.cropper.x2+i,t.x1+n.cropperScaledMaxWidth),t.x1+n.cropperScaledMinWidth),t.y1=Math.min(Math.max(e.cropper.y1+r,t.y2-n.cropperScaledMaxHeight),t.y2-n.cropperScaledMinHeight);break;case"right":t.x2=Math.max(Math.min(e.cropper.x2+i,t.x1+n.cropperScaledMaxWidth),t.x1+n.cropperScaledMinWidth);break;case"bottomright":t.x2=Math.max(Math.min(e.cropper.x2+i,t.x1+n.cropperScaledMaxWidth),t.x1+n.cropperScaledMinWidth),t.y2=Math.max(Math.min(e.cropper.y2+r,t.y1+n.cropperScaledMaxHeight),t.y1+n.cropperScaledMinHeight);break;case"bottom":t.y2=Math.max(Math.min(e.cropper.y2+r,t.y1+n.cropperScaledMaxHeight),t.y1+n.cropperScaledMinHeight);break;case"bottomleft":t.x1=Math.min(Math.max(e.cropper.x1+i,t.x2-n.cropperScaledMaxWidth),t.x2-n.cropperScaledMinWidth),t.y2=Math.max(Math.min(e.cropper.y2+r,t.y1+n.cropperScaledMaxHeight),t.y1+n.cropperScaledMinHeight);break;case"center":let a="scale"in o?o.scale:1,s=Math.min(Math.max(n.cropperScaledMinWidth,Math.abs(e.cropper.x2-e.cropper.x1)*a),n.cropperScaledMaxWidth),c=Math.min(Math.max(n.cropperScaledMinHeight,Math.abs(e.cropper.y2-e.cropper.y1)*a),n.cropperScaledMaxHeight);t.x1=e.clientX-s/2,t.x2=e.clientX+s/2,t.y1=e.clientY-c/2,t.y2=e.clientY+c/2,t.x1<0?(t.x2-=t.x1,t.x1=0):t.x2>n.maxSize().width&&(t.x1-=t.x2-n.maxSize().width,t.x2=n.maxSize().width),t.y1<0?(t.y2-=t.y1,t.y1=0):t.y2>n.maxSize().height&&(t.y1-=t.y2-n.maxSize().height,t.y2=n.maxSize().height);break}return n.options.maintainAspectRatio?Ot(e.position,t,n):t}function Ot(o,e,n){e=_({},e);let t=0,i=0;switch(o){case"top":e.x2=e.x1+(e.y2-e.y1)*n.options.aspectRatio,t=Math.max(e.x2-n.maxSize().width,0),i=Math.max(0-e.y1,0),(t>0||i>0)&&(e.x2-=i*n.options.aspectRatio>t?i*n.options.aspectRatio:t,e.y1+=i*n.options.aspectRatio>t?i:t/n.options.aspectRatio);break;case"bottom":e.x2=e.x1+(e.y2-e.y1)*n.options.aspectRatio,t=Math.max(e.x2-n.maxSize().width,0),i=Math.max(e.y2-n.maxSize().height,0),(t>0||i>0)&&(e.x2-=i*n.options.aspectRatio>t?i*n.options.aspectRatio:t,e.y2-=i*n.options.aspectRatio>t?i:t/n.options.aspectRatio);break;case"topleft":e.y1=e.y2-(e.x2-e.x1)/n.options.aspectRatio,t=Math.max(0-e.x1,0),i=Math.max(0-e.y1,0),(t>0||i>0)&&(e.x1+=i*n.options.aspectRatio>t?i*n.options.aspectRatio:t,e.y1+=i*n.options.aspectRatio>t?i:t/n.options.aspectRatio);break;case"topright":e.y1=e.y2-(e.x2-e.x1)/n.options.aspectRatio,t=Math.max(e.x2-n.maxSize().width,0),i=Math.max(0-e.y1,0),(t>0||i>0)&&(e.x2-=i*n.options.aspectRatio>t?i*n.options.aspectRatio:t,e.y1+=i*n.options.aspectRatio>t?i:t/n.options.aspectRatio);break;case"right":case"bottomright":e.y2=e.y1+(e.x2-e.x1)/n.options.aspectRatio,t=Math.max(e.x2-n.maxSize().width,0),i=Math.max(e.y2-n.maxSize().height,0),(t>0||i>0)&&(e.x2-=i*n.options.aspectRatio>t?i*n.options.aspectRatio:t,e.y2-=i*n.options.aspectRatio>t?i:t/n.options.aspectRatio);break;case"left":case"bottomleft":e.y2=e.y1+(e.x2-e.x1)/n.options.aspectRatio,t=Math.max(0-e.x1,0),i=Math.max(e.y2-n.maxSize().height,0),(t>0||i>0)&&(e.x1+=i*n.options.aspectRatio>t?i*n.options.aspectRatio:t,e.y2-=i*n.options.aspectRatio>t?i:t/n.options.aspectRatio);break;case"center":e.x2=e.x1+(e.y2-e.y1)*n.options.aspectRatio,e.y2=e.y1+(e.x2-e.x1)/n.options.aspectRatio;let r=Math.max(0-e.x1,0),a=Math.max(e.x2-n.maxSize().width,0),s=Math.max(e.y2-n.maxSize().height,0),c=Math.max(0-e.y1,0);(r>0||a>0||s>0||c>0)&&(e.x1+=s*n.options.aspectRatio>r?s*n.options.aspectRatio:r,e.x2-=c*n.options.aspectRatio>a?c*n.options.aspectRatio:a,e.y1+=c*n.options.aspectRatio>a?c:a/n.options.aspectRatio,e.y2-=s*n.options.aspectRatio>r?s:r/n.options.aspectRatio);break}return e}function le(o){return"touches"in o&&o.touches[0]?o.touches[0].clientX:"clientX"in o?o.clientX:0}function he(o){return"touches"in o&&o.touches[0]?o.touches[0].clientY:"clientX"in o?o.clientY:0}var we=class{constructor(){this.cropper=K({x1:0,x2:0,y1:0,y2:0}),this.maxSize=K({width:0,height:0}),this.transform={},this.options={format:"png",output:"blob",autoCrop:!0,maintainAspectRatio:!0,aspectRatio:1,resetCropOnAspectRatioChange:!0,resizeToWidth:0,resizeToHeight:0,cropperMinWidth:0,cropperMinHeight:0,cropperMaxHeight:0,cropperMaxWidth:0,cropperStaticWidth:0,cropperStaticHeight:0,canvasRotation:0,roundCropper:!1,onlyScaleDown:!1,imageQuality:92,backgroundColor:void 0,containWithinAspectRatio:!1,hideResizeSquares:!1,alignImage:"center",cropperFrameAriaLabel:void 0,checkImageType:!0},this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=3}setOptionsFromChanges(e){e.options?.currentValue&&this.setOptions(e.options.currentValue);let n=Object.entries(e).filter(([t])=>t in this.options).reduce((t,[i,r])=>T(_({},t),{[i]:r.currentValue}),{});Object.keys(n).length>0&&this.setOptions(n)}setOptions(e){if(this.options=_(_({},this.options),e||{}),this.validateOptions(),!this.loadedImage?.transformed.image.complete||!this.maxSize)return;let n=!1;this.options.maintainAspectRatio&&e.aspectRatio||"maintainAspectRatio"in e?(this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.options.maintainAspectRatio&&(this.options.resetCropOnAspectRatioChange||!this.aspectRatioIsCorrect())&&(this.cropper.set(this.maxSizeCropperPosition()),n=!0)):((e.cropperMinWidth||e.cropperMinHeight)&&(this.setCropperScaledMinSize(),n=!0),(e.cropperMaxWidth||e.cropperMaxHeight)&&(this.setCropperScaledMaxSize(),n=!0),(e.cropperStaticWidth||e.cropperStaticHeight)&&(n=!0)),n&&this.cropper.update(t=>N(t,this,!1))}validateOptions(){if(this.options.maintainAspectRatio&&!this.options.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}setMaxSize(e,n){this.maxSize.set({width:e,height:n}),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}setCropperScaledMinSize(){this.loadedImage?.transformed.size?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.cropperScaledMinWidth=this.options.cropperMinWidth>0?Math.max(20,this.options.cropperMinWidth/this.loadedImage.transformed.size.width*this.maxSize().width):20}setCropperScaledMinHeight(){this.options.maintainAspectRatio?this.cropperScaledMinHeight=Math.max(20,this.cropperScaledMinWidth/this.options.aspectRatio):this.options.cropperMinHeight>0?this.cropperScaledMinHeight=Math.max(20,this.options.cropperMinHeight/this.loadedImage.transformed.size.height*this.maxSize().height):this.cropperScaledMinHeight=20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed.size){let e=this.loadedImage.transformed.size.width/this.maxSize().width;this.cropperScaledMaxWidth=this.options.cropperMaxWidth>20?this.options.cropperMaxWidth/e:this.maxSize().width,this.cropperScaledMaxHeight=this.options.cropperMaxHeight>20?this.options.cropperMaxHeight/e:this.maxSize().height,this.options.maintainAspectRatio&&(this.cropperScaledMaxWidth>this.cropperScaledMaxHeight*this.options.aspectRatio?this.cropperScaledMaxWidth=this.cropperScaledMaxHeight*this.options.aspectRatio:this.cropperScaledMaxWidth<this.cropperScaledMaxHeight*this.options.aspectRatio&&(this.cropperScaledMaxHeight=this.cropperScaledMaxWidth/this.options.aspectRatio))}else this.cropperScaledMaxWidth=this.maxSize().width,this.cropperScaledMaxHeight=this.maxSize().height}equalsCropperPosition(e){let n=this.cropper();return n==null&&e==null||n!=null&&e!=null&&n.x1.toFixed(3)===e.x1.toFixed(3)&&n.y1.toFixed(3)===e.y1.toFixed(3)&&n.x2.toFixed(3)===e.x2.toFixed(3)&&n.y2.toFixed(3)===e.y2.toFixed(3)}equalsTransformTranslate(e){return(this.transform.translateH??0)===(e.translateH??0)&&(this.transform.translateV??0)===(e.translateV??0)}equalsTransform(e){return this.equalsTransformTranslate(e)&&(this.transform.scale??1)===(e.scale??1)&&(this.transform.rotate??0)===(e.rotate??0)&&(this.transform.flipH??!1)===(e.flipH??!1)&&(this.transform.flipV??!1)===(e.flipV??!1)}aspectRatioIsCorrect(){let e=this.cropper();return(e.x2-e.x1)/(e.y2-e.y1)===this.options.aspectRatio}resizeCropperPosition(e){(e.width!==this.maxSize().width||e.height!==this.maxSize().height)&&this.cropper.update(n=>({x1:n.x1*this.maxSize().width/e.width,x2:n.x2*this.maxSize().width/e.width,y1:n.y1*this.maxSize().height/e.height,y2:n.y2*this.maxSize().height/e.height}))}maxSizeCropperPosition(){return{x1:0,y1:0,x2:this.maxSize().width,y2:this.maxSize().height}}toCropInput(){return{cropper:this.cropper(),maxSize:this.maxSize(),transform:this.transform,loadedImage:this.loadedImage,options:_({},this.options)}}},b=function(o){return o.Drag="drag",o.Move="move",o.Resize="resize",o.Pinch="pinch",o}(b||{});function Pt(o,e,n){let t=o.width,i=o.height;e=Math.round(e),n=Math.round(n);let r=t/e,a=i/n,s=Math.ceil(r/2),c=Math.ceil(a/2),g=o.getContext("2d");if(g){let z=g.getImageData(0,0,t,i),v=g.createImageData(e,n),w=z.data,y=v.data;for(let I=0;I<n;I++)for(let U=0;U<e;U++){let G=(U+I*e)*4,_t=I*a,R=0,$=0,ve=0,Ie=0,ze=0,Re=0,Te=0,Ct=Math.floor(U*r),wt=Math.floor(I*a),me=Math.ceil((U+1)*r),pe=Math.ceil((I+1)*a);me=Math.min(me,t),pe=Math.min(pe,i);for(let J=wt;J<pe;J++){let Se=Math.abs(_t-J)/c,yt=U*r,Mt=Se*Se;for(let Z=Ct;Z<me;Z++){let Oe=Math.abs(yt-Z)/s,k=Math.sqrt(Mt+Oe*Oe);if(k>=1)continue;R=2*k*k*k-3*k*k+1;let E=4*(Z+J*t);Te+=R*w[E+3],ve+=R,w[E+3]<255&&(R=R*w[E+3]/250),Ie+=R*w[E],ze+=R*w[E+1],Re+=R*w[E+2],$+=R}}y[G]=Ie/$,y[G+1]=ze/$,y[G+2]=Re/$,y[G+3]=Te/ve}o.width=e,o.height=n,g.putImageData(v,0,0)}}function ut(o,e){return o/100*e}var ye=class{crop(e,n){let t=this.getImagePosition(e),i=t.x2-t.x1,r=t.y2-t.y1,a=document.createElement("canvas");a.width=i,a.height=r;let s=a.getContext("2d");if(!s)return null;e.options?.backgroundColor!=null&&(s.fillStyle=e.options.backgroundColor,s.fillRect(0,0,i,r));let c=(e.transform?.scale||1)*(e.transform?.flipH?-1:1),g=(e.transform?.scale||1)*(e.transform?.flipV?-1:1),{translateH:z,translateV:v}=this.getCanvasTranslate(e),w=e.loadedImage.transformed;s.setTransform(c,0,0,g,w.size.width/2+z,w.size.height/2+v),s.translate(-t.x1/c,-t.y1/g),s.rotate((e.transform?.rotate||0)*Math.PI/180),s.drawImage(w.image,-w.size.width/2,-w.size.height/2);let y={width:i,height:r,imagePosition:t,cropperPosition:_({},e.cropper)};e.options?.containWithinAspectRatio&&(y.offsetImagePosition=this.getOffsetImagePosition(e));let I=this.getResizeRatio(i,r,e.options);return I!==1&&(y.width=Math.round(i*I),y.height=e.options?.maintainAspectRatio?Math.round(y.width/(e.options?.aspectRatio??1)):Math.round(r*I),Pt(a,y.width,y.height)),n==="blob"?this.cropToBlob(y,a,e):(y.base64=a.toDataURL("image/"+(e.options?.format??"png"),this.getQuality(e.options)),y)}cropToBlob(e,n,t){return u(this,null,function*(){return e.blob=yield new Promise(i=>n.toBlob(i,"image/"+(t.options?.format??"png"),this.getQuality(t.options))),e.blob&&(e.objectUrl=URL.createObjectURL(e.blob)),e})}getCanvasTranslate(e){if(e.transform?.translateUnit==="px"){let n=this.getRatio(e);return{translateH:(e.transform?.translateH||0)*n,translateV:(e.transform?.translateV||0)*n}}else return{translateH:e.transform?.translateH?ut(e.transform.translateH,e.loadedImage.transformed.size.width):0,translateV:e.transform?.translateV?ut(e.transform.translateV,e.loadedImage.transformed.size.height):0}}getRatio(e){return e.loadedImage.transformed.size.width/e.maxSize.width}getImagePosition(e){let n=this.getRatio(e),t={x1:Math.round(e.cropper.x1*n),y1:Math.round(e.cropper.y1*n),x2:Math.round(e.cropper.x2*n),y2:Math.round(e.cropper.y2*n)};return e.options?.containWithinAspectRatio||(t.x1=Math.max(t.x1,0),t.y1=Math.max(t.y1,0),t.x2=Math.min(t.x2,e.loadedImage.transformed.size.width),t.y2=Math.min(t.y2,e.loadedImage.transformed.size.height)),t}getOffsetImagePosition(e){let n=(e.options?.canvasRotation??0)+e.loadedImage.exifTransform.rotate,t=this.getRatio(e),i,r;n%2?(i=(e.loadedImage.transformed.size.width-e.loadedImage.original.size.height)/2,r=(e.loadedImage.transformed.size.height-e.loadedImage.original.size.width)/2):(i=(e.loadedImage.transformed.size.width-e.loadedImage.original.size.width)/2,r=(e.loadedImage.transformed.size.height-e.loadedImage.original.size.height)/2);let a=e.cropper,s={x1:Math.round(a.x1*t)-i,y1:Math.round(a.y1*t)-r,x2:Math.round(a.x2*t)-i,y2:Math.round(a.y2*t)-r};return e.options?.containWithinAspectRatio||(s.x1=Math.max(s.x1,0),s.y1=Math.max(s.y1,0),s.x2=Math.min(s.x2,e.loadedImage.transformed.size.width),s.y2=Math.min(s.y2,e.loadedImage.transformed.size.height)),s}getResizeRatio(e,n,t){let i=new Array;t?.resizeToWidth&&t.resizeToWidth>0&&i.push(t.resizeToWidth/e),t?.resizeToHeight&&t.resizeToHeight>0&&i.push(t.resizeToHeight/n);let r=i.length===0?1:Math.min(...i);return r>1&&!t?.onlyScaleDown?r:Math.min(r,1)}getQuality(e){return Math.min(1,Math.max(0,(e?.imageQuality??92)/100))}},Vt=[new Uint8Array([255,216,255,225,0,34,69,120,105,102,0,0,77,77,0,42,0,0,0,8,0,1,1,18,0,3,0,0,0,1,0,6,0,0,0,0,0,0,255,219,0,132,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,255,192,0,17,8,0,1,0,2,3,1,17,0,2,17,1,3,17,1,255,196,0,74,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,218,0,12,3,1,0,2,17,3,17,0,63,0,63,240,127,255,217])],Ft=URL.createObjectURL(new Blob(Vt,{type:"image/jpeg"}));function At(){return new Promise(o=>{let e=new Image;e.onload=()=>{let n=e.width===1&&e.height===2;o(n)},e.src=Ft})}function Ut(o){switch(typeof o=="object"&&(o=kt(o)),o){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}function kt(o){let e=new DataView(o);if(e.getUint16(0,!1)!==65496)return-2;let n=e.byteLength,t=2;for(;t<n;){if(e.getUint16(t+2,!1)<=8)return-1;let i=e.getUint16(t,!1);if(t+=2,i==65505){if(e.getUint32(t+=2,!1)!==1165519206)return-1;let r=e.getUint16(t+=6,!1)==18761;t+=e.getUint32(t+4,r);let a=e.getUint16(t,r);t+=2;for(let s=0;s<a;s++)if(e.getUint16(t+s*12,r)==274)return e.getUint16(t+s*12+8,r)}else{if((i&65280)!==65280)break;t+=e.getUint16(t,!1)}}return-1}var Me=class{constructor(){this.autoRotateSupported=At()}loadImageFile(e,n){return u(this,null,function*(){let t=yield e.arrayBuffer();return n.checkImageType?yield this.checkImageTypeAndLoadImageFromArrayBuffer(t,e.type,n):yield this.loadImageFromArrayBuffer(t,n)})}checkImageTypeAndLoadImageFromArrayBuffer(e,n,t){return this.isValidImageType(n)?this.loadImageFromArrayBuffer(e,t,n):Promise.reject(new Error("Invalid image type"))}isValidImageType(e){return/image\/(png|jpg|jpeg|heic|bmp|gif|tiff|svg|webp|x-icon|vnd.microsoft.icon)/.test(e)}loadImageFromURL(e,n){return u(this,null,function*(){let i=yield(yield fetch(e)).blob(),r=yield i.arrayBuffer();return yield this.loadImageFromArrayBuffer(r,n,i.type)})}loadBase64Image(e,n){let t=this.base64ToArrayBuffer(e);return this.loadImageFromArrayBuffer(t,n)}base64ToArrayBuffer(e){e=e.replace(/^data:([^;]+);base64,/gmi,"");let n=atob(e),t=n.length,i=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=n.charCodeAt(r);return i.buffer}loadImageFromArrayBuffer(e,n,t){return u(this,null,function*(){let i=yield new Promise((r,a)=>u(this,null,function*(){try{let s=new Blob([e],t?{type:t}:void 0),c=URL.createObjectURL(s),g=new Image,v=t==="image/svg+xml"?yield this.getSvgImageSize(s):void 0;g.onload=()=>r({originalImage:g,originalImageSize:v,originalObjectUrl:c,originalArrayBuffer:e}),g.onerror=a,g.src=c}catch(s){a(s)}}));return yield this.transformImageFromArrayBuffer(i,n,i.originalImageSize!=null)})}getSvgImageSize(e){return u(this,null,function*(){let i=new DOMParser().parseFromString(yield e.text(),"image/svg+xml").querySelector("svg");if(!i)throw Error("Failed to parse SVG image");let r=i.getAttribute("width"),a=i.getAttribute("height");if(r&&a)return null;let s=i.getAttribute("viewBox")||i.getAttribute("viewbox");if(s){let c=s.split(" ");return{width:+c[2],height:+c[3]}}throw Error("Failed to load SVG image. SVG must have width + height or viewBox definition.")})}transformImageFromArrayBuffer(e,n,t=!1){return u(this,null,function*(){let i=yield this.autoRotateSupported,r=Ut(i?-1:e.originalArrayBuffer);if(!e.originalImage||!e.originalImage.complete)return Promise.reject(new Error("No image loaded"));let a={original:{objectUrl:e.originalObjectUrl,image:e.originalImage,size:e.originalImageSize??{width:e.originalImage.naturalWidth,height:e.originalImage.naturalHeight}},exifTransform:r};return this.transformLoadedImage(a,n,t)})}transformLoadedImage(e,n,t=!1){return u(this,null,function*(){let i=(n.canvasRotation??0)+e.exifTransform.rotate,r=e.original.size;if(!t&&i===0&&!e.exifTransform.flip&&!n.containWithinAspectRatio)return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:_({},r)},transformed:{objectUrl:e.original.objectUrl,image:e.original.image,size:_({},r)},exifTransform:e.exifTransform};let a=this.getTransformedSize(r,e.exifTransform,n),s=document.createElement("canvas");s.width=a.width,s.height=a.height;let c=s.getContext("2d");c?.setTransform(e.exifTransform.flip?-1:1,0,0,1,s.width/2,s.height/2),c?.rotate(Math.PI*(i/2)),c?.drawImage(e.original.image,-r.width/2,-r.height/2);let g=yield new Promise(w=>s.toBlob(w,"image/"+(n.format??"png")));if(!g)throw new Error("Failed to get Blob for transformed image.");let z=URL.createObjectURL(g),v=yield this.loadImageFromObjectUrl(z);return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:_({},r)},transformed:{objectUrl:z,image:v,size:{width:v.width,height:v.height}},exifTransform:e.exifTransform}})}loadImageFromObjectUrl(e){return new Promise((n,t)=>{let i=new Image;i.onload=()=>n(i),i.onerror=t,i.src=e})}getTransformedSize(e,n,t){let i=(t.canvasRotation??0)+n.rotate;if(t.containWithinAspectRatio)if(i%2){let r=e.width*(t.aspectRatio??1),a=e.height/(t.aspectRatio??1);return{width:Math.max(e.height,r),height:Math.max(e.width,a)}}else{let r=e.height*(t.aspectRatio??1),a=e.width/(t.aspectRatio??1);return{width:Math.max(e.width,r),height:Math.max(e.height,a)}}return i%2?{height:e.width,width:e.height}:{width:e.width,height:e.height}}};function Et(o){switch(o){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";case"ArrowLeft":default:return"left"}}function Ht(o){switch(o){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";case"ArrowLeft":default:return"right"}}function Wt(o,e){switch(o){case"ArrowUp":return{clientX:0,clientY:e*-1};case"ArrowRight":return{clientX:e,clientY:0};case"ArrowDown":return{clientX:0,clientY:e};case"ArrowLeft":default:return{clientX:e*-1,clientY:0}}}var be=(()=>{let e=class e{get alignImageStyle(){return this.state.options.alignImage}constructor(t){this.sanitizer=t,this.pinchStart$=new Pe,this.cropService=new ye,this.loadImageService=new Me,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.moveTypes=b,this.state=new we,this.safeImgDataUrl=K(void 0),this.safeTransformStyle=K(void 0),this.marginLeft="0px",this.imageVisible=!1,this.allowMoveImage=!1,this.checkImageType=!0,this.disabled=!1,this.hidden=!1,this.imageCropped=V(),this.startCropImage=V(),this.imageLoaded=V(),this.cropperReady=V(),this.loadImageFailed=V(),this.transformChange=V(),this.cropperChange=V(),this.reset()}ngOnInit(){this.state.stepSize=this.initialStepSize||this.state.stepSize}ngOnChanges(t){let i=this.state.cropper(),r=this.state.transform,a=this.state.options.backgroundColor;if(this.state.setOptionsFromChanges(t),this.onChangesInputImage(t),t.transform&&this.transform&&(this.state.transform=this.transform,this.setCssTransform()),!this.state.loadedImage?.transformed.image.complete||!this.state.maxSize)return;if(this.containWithinAspectRatio&&t.aspectRatio||t.containWithinAspectRatio||t.canvasRotation){this.loadImageService.transformLoadedImage(this.state.loadedImage,this.state.options).then(c=>this.setLoadedImage(c)).catch(c=>this.loadImageError(c));return}t.cropper&&this.cropper&&this.state.cropper.set(N(this.cropper,this.state,!0));let s=!this.state.equalsCropperPosition(i);s&&(!this.cropper||!this.state.equalsCropperPosition(this.cropper))&&this.cropperChange.emit(this.state.cropper()),(s||!this.state.equalsTransform(r)||this.state.options.backgroundColor!==a)&&this.doAutoCrop(),t.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesInputImage(t){(t.imageChangedEvent||t.imageURL||t.imageBase64||t.imageFile)&&this.reset(),t.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),t.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),t.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),t.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){let t=this.imageChangedEvent?.target?.files;return t instanceof FileList&&t.length>0}reset(){this.state.loadedImage=void 0,this.state.maxSize.set({width:0,height:0}),this.imageVisible=!1}loadImageFile(t){this.loadImageService.loadImageFile(t,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadBase64Image(t){this.loadImageService.loadBase64Image(t,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadImageFromURL(t){this.loadImageService.loadImageFromURL(t,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}setLoadedImage(t){this.state.loadedImage=t,this.safeImgDataUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(t.transformed.objectUrl))}loadImageError(t){console.error(t),this.loadImageFailed.emit()}setCssTransform(){let t=this.state.transform?.translateUnit||"%";this.safeTransformStyle.set(this.sanitizer.bypassSecurityTrustStyle(`translate(${this.state.transform.translateH||0}${t}, ${this.state.transform.translateV||0}${t}) scaleX(`+(this.state.transform.scale||1)*(this.state.transform.flipH?-1:1)+") scaleY("+(this.state.transform.scale||1)*(this.state.transform.flipV?-1:1)+") rotate("+(this.state.transform.rotate||0)+"deg)"))}imageLoadedInView(){this.state.loadedImage!=null&&(this.imageLoaded.emit(this.state.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.cropper&&(!this.maintainAspectRatio||this.state.aspectRatioIsCorrect())?(this.state.cropper.set(N(this.cropper,this.state,!0)),this.emitCropperPositionChange(this.cropper)):(this.state.cropper.set(N(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())),this.imageVisible=!0,this.cropperReady.emit(this.state.maxSize()),this.doAutoCrop()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>1}onResize(){if(this.state.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{let t=this.state.maxSize();this.setMaxSize(),this.state.resizeCropperPosition(t)}}keyboardAccess(t){this.changeKeyboardStepSize(t),this.keyboardMoveCropper(t)}changeKeyboardStepSize(t){let i=+t.key;i>=1&&i<=9&&(this.state.stepSize=i)}keyboardMoveCropper(t){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t.key))return;let r=t.shiftKey?b.Resize:b.Move,a=t.altKey?Ht(t.key):Et(t.key),s=Wt(t.key,this.state.stepSize);t.preventDefault(),t.stopPropagation(),this.moveStart={type:r,position:a,clientX:0,clientY:0,transform:this.state.transform,cropper:this.state.cropper()},this.handleMouseMove(s),this.handleMouseUp()}startMove(t,i,r=null){this.disabled||this.moveStart&&this.moveStart.type===b.Pinch||i===b.Drag&&!this.allowMoveImage||("preventDefault"in t&&t.preventDefault(),this.moveStart={type:i,position:r,clientX:le(t),clientY:he(t),transform:this.state.transform,cropper:this.state.cropper()},this.initMouseMove())}initMouseMove(){de(A(document,"mousemove"),A(document,"touchmove")).pipe(ge(de(A(document,"mouseup"),A(document,"touchend"),this.pinchStart$).pipe(Ve()))).subscribe({next:t=>this.handleMouseMove(t),complete:()=>this.handleMouseUp()})}handleMouseMove(t){if(this.moveStart){if("stopPropagation"in t&&t.stopPropagation(),"preventDefault"in t&&t.preventDefault(),this.moveStart.type===b.Move)this.state.cropper.set(ce(St(t,this.moveStart),this.state,!0));else if(this.moveStart.type===b.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(ce(gt(t,this.moveStart,this.state),this.state,!1));else if(this.moveStart.type===b.Drag){let i=le(t)-this.moveStart.clientX,r=he(t)-this.moveStart.clientY;this.state.transform=T(_({},this.state.transform),{translateH:(this.moveStart.transform?.translateH||0)+i,translateV:(this.moveStart.transform?.translateV||0)+r}),this.setCssTransform()}}}handleMouseUp(){!this.moveStart||this.moveStart.type===b.Pinch||((!this.state.equalsCropperPosition(this.moveStart.cropper)||this.moveStart.transform&&!this.state.equalsTransform(this.moveStart.transform))&&(this.moveStart.type===b.Drag?this.transformChange.emit(this.state.transform):this.cropperChange.emit(this.state.cropper()),this.doAutoCrop()),this.moveStart=void 0)}startPinch(t){if(this.disabled||!this.sourceImageLoaded()||t.touches.length<2)return;"preventDefault"in t&&t.preventDefault();let i=this.state.cropper();this.moveStart={type:b.Pinch,position:"center",clientX:i.x1+(i.x2-i.x1)/2,clientY:i.y1+(i.y2-i.y1)/2,cropper:i},this.initPinch()}initPinch(){this.pinchStart$.next(),A(document,"touchmove").pipe(ge(A(document,"touchend"))).subscribe({next:t=>this.handlePinchMove(t),complete:()=>this.handlePinchStop()})}handlePinchMove(t){this.moveStart&&(t.preventDefault&&t.preventDefault(),this.moveStart.type===b.Pinch&&!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(ce(gt(t,this.moveStart,this.state),this.state,!1)))}handlePinchStop(){this.moveStart&&(this.state.equalsCropperPosition(this.moveStart.cropper)||(this.emitCropperPositionChange(this.moveStart.cropper),this.doAutoCrop()),this.moveStart=void 0)}setMaxSize(){if(this.sourceImage){let t=getComputedStyle(this.sourceImage.nativeElement);this.state.setMaxSize(parseFloat(t.width),parseFloat(t.height)),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.state.maxSize().width/2+"px)")}}emitCropperPositionChange(t){this.state.equalsCropperPosition(t)||this.cropperChange.emit(this.state.cropper())}doAutoCrop(){this.state.options.autoCrop&&this.crop()}crop(t=this.state.options.output){if(this.state.loadedImage?.transformed?.image!=null){if(this.startCropImage.emit(),t==="blob")return this.cropToBlob();if(t==="base64")return this.cropToBase64()}return null}cropToBlob(){return new Promise((t,i)=>u(this,null,function*(){let r=yield this.cropService.crop(this.state.toCropInput(),"blob");r?(this.imageCropped.emit(r),t(r)):i("Crop image failed")}))}cropToBase64(){let t=this.cropService.crop(this.state.toCropInput(),"base64");return t?(this.imageCropped.emit(t),t):null}resetCropperPosition(){this.state.cropper.set(N(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())}ngOnDestroy(){this.pinchStart$.complete()}};e.\u0275fac=function(i){return new(i||e)(ke(Be))},e.\u0275cmp=H({type:e,selectors:[["image-cropper"]],viewQuery:function(i,r){if(i&1&&(L(bt,7),L(vt,5)),i&2){let a;D(a=B())&&(r.wrapper=a.first),D(a=B())&&(r.sourceImage=a.first)}},hostVars:6,hostBindings:function(i,r){i&1&&f("resize",function(){return r.onResize()},Ue),i&2&&(q("text-align",r.alignImageStyle),ee("disabled",r.disabled)("ngx-ic-hidden",r.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",options:"options",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",autoCrop:"autoCrop",cropper:"cropper",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",checkImageType:"checkImageType",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange",cropperChange:"cropperChange"},features:[Fe],decls:4,vars:10,consts:[["sourceImage",""],[3,"touchstart"],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"load","mousedown","touchstart","error","src"],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left",3,"mousedown","touchstart"]],template:function(i,r){i&1&&(p(0,"div",1),f("touchstart",function(s){return r.startPinch(s)}),W(1,It,2,8,"img",2),x(2,"div",3),W(3,Rt,3,16,"div",4),d()),i&2&&(q("background",r.imageVisible&&r.state.options.backgroundColor),C(),M("ngIf",r.safeImgDataUrl()),C(),q("width",r.state.maxSize().width||0,"px")("height",r.state.maxSize().height||0,"px")("margin-left",r.state.options.alignImage==="center"?r.marginLeft:null),C(),M("ngIf",r.imageVisible))},dependencies:[De],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{display:inline;max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:var(--cropper-color, #53535C);background:transparent;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:var(--cropper-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:hover   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-hover-border, var(--cropper-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-focus-border, 2px solid dodgerblue)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-focus-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-focus-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;width:6px;height:6px;box-sizing:content-box;background:var(--cropper-resize-square-bg, #53535C);border:var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]:hover   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-hover-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-hover-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ic-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0});let o=e;return o})();function Lt(o,e){if(o&1){let n=O();p(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",4)(3,"ion-button",5),f("click",function(){h(n);let i=l();return m(i.cancel())}),P(4,"Cancel"),d()(),p(5,"ion-buttons",6)(6,"ion-button",7),f("click",function(){h(n);let i=l();return m(i.confirm())}),P(7,"Confirm"),d()()()(),p(8,"ion-content",8),x(9,"image-cropper",9,0),d()}if(o&2){let n=l();C(6),M("strong",!0),C(3),M("imageFile",n.selectedImage)("autoCrop",!1)}}var xt=(()=>{let e=class e{constructor(){this.errorHandler=S(se),this.onImageCropped=new Ee,ht({add:mt})}triggerFileInput(){return u(this,null,function*(){let t=yield dt.getPhoto({quality:100,allowEditing:!0,resultType:Ce.DataUrl,source:F.Photos});try{this.selectedImage=yield this.dataURLToFile(t.dataUrl,"image.jpg")}catch(i){this.errorHandler.handleError(i)}this.modal.present()})}webPathToFile(t,i){return u(this,null,function*(){let a=yield(yield fetch(t)).blob();return new File([a],i,{type:a.type})})}dataURLToFile(t,i){let r=t.split(","),a=r[0].match(/:(.*?);/)?.[1]||"image/jpeg",s=atob(r[1]),c=s.length,g=new Uint8Array(c);for(;c--;)g[c]=s.charCodeAt(c);return new File([g],i,{type:a})}cancel(){this.modal.dismiss(null,"cancel")}confirm(){try{this.imageCropper.crop("blob")?.then(t=>{if(t?.blob){let i=new File([t.blob],"image.jpg",{type:t.blob.type,lastModified:Date.now()});this.modal.dismiss(i,"confirm")}else this.errorHandler.handleError("blob.blob is null or undefined")})}catch(t){this.errorHandler.handleError(t)}}onWillDismiss(t){t.detail.role==="confirm"&&this.onImageCropped.emit(t.detail.data)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=H({type:e,selectors:[["app-image-uploader"]],viewQuery:function(i,r){if(i&1&&(L(_e,5),L(be,5)),i&2){let a;D(a=B())&&(r.modal=a.first),D(a=B())&&(r.imageCropper=a.first)}},outputs:{onImageCropped:"onImageCropped"},decls:5,vars:0,consts:[["imageCropper",""],["expand","block",3,"click"],["name","add"],[3,"willDismiss"],["slot","start"],[3,"click"],["slot","end"],[3,"click","strong"],[1,"ion-padding"],[3,"imageFile","autoCrop"]],template:function(i,r){i&1&&(p(0,"ion-button",1),f("click",function(){return r.triggerFileInput()}),x(1,"ion-icon",2),P(2,` Upload Image
`),d(),p(3,"ion-modal",3),f("willDismiss",function(s){return r.onWillDismiss(s)}),W(4,Lt,11,3,"ng-template"),d())},dependencies:[Je,te,ie,ne,re,_e,oe,at,be],styles:[".preview-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:1rem}.preview-img[_ngcontent-%COMP%]{max-width:250px;border-radius:12px;margin-top:1rem;box-shadow:0 4px 10px #0000001a}"]});let o=e;return o})();function Dt(o,e){if(o&1&&x(0,"ion-img",4),o&2){let n=l(2);M("src",n.croppedImageUrl)}}function Bt(o,e){if(o&1){let n=O();p(0,"app-image-uploader",6),f("onImageCropped",function(i){h(n);let r=l();return m(r.handleCroppedImage(i))}),d(),j(1,Dt,1,1,"ion-img",4)}if(o&2){let n=l();C(),X(n.croppedImageUrl?1:-1)}}function qt(o,e){if(o&1&&x(0,"ion-img",4),o&2){let n=l();M("src",n.currentKid==null?null:n.currentKid.profile_picture_url)}}function Kt(o,e){o&1&&x(0,"ion-spinner")}function jt(o,e){if(o&1&&(p(0,"span"),P(1),d()),o&2){let n=l();C(),fe("",n.is_edit_mode?"Edit":"Add"," Child")}}var Ei=(()=>{let e=class e{constructor(){this.router=S(Ke),this.route=S(qe),this.cdr=S(Le),this.kidsStore=S(pt),this.errorHandler=S(se),this.kidId=null,this.currentKid=void 0,this.croppedImageFile=null,this.croppedImageUrl=null,this.loading=!1,this.is_edit_mode=!1,this.addKidForm=new Ye({name:new Qe("",[xe.required,xe.maxLength(50)])})}ionViewWillEnter(){if(this.kidId=this.route.snapshot.paramMap.get("kidId"),this.kidId){if(this.is_edit_mode=!0,this.currentKid=this.kidsStore.kids().find(t=>t.id==this.kidId),this.currentKid==null){this.errorHandler.handleError("Kid not found"),this.router.navigate(["/tabs/kids-list"]);return}this.addKidForm.patchValue({name:this.currentKid.name})}}handleCroppedImage(t){if(this.croppedImageFile=t,t){let i=new FileReader;this.loading=!0,i.onload=r=>{this.croppedImageUrl=r.target?.result??null,this.cdr.markForCheck(),this.loading=!1},i.readAsDataURL(t)}}onSubmit(){return u(this,null,function*(){if(!this.addKidForm.invalid){this.loading=!0;try{this.is_edit_mode?yield this.kidsStore.updateKid(T(_({},this.currentKid),{name:this.addKidForm.value.name}),this.croppedImageFile??void 0):yield this.kidsStore.addKid({name:this.addKidForm.value.name,profile_picture_file:this.croppedImageFile??void 0}),this.router.navigate(["/tabs/kids-list"])}catch(t){this.errorHandler.handleError(t)}finally{this.loading=!1}}})}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=H({type:e,selectors:[["app-kid-form"]],decls:17,vars:6,consts:[["slot","start"],[3,"ngSubmit","formGroup"],["position","floating"],["formControlName","name","type","text"],[3,"src"],["type","submit","expand","block",3,"disabled"],[3,"onImageCropped"]],template:function(i,r){i&1&&(p(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),x(3,"ion-back-button"),d(),p(4,"ion-title"),P(5),d()()(),p(6,"ion-content")(7,"form",1),f("ngSubmit",function(){return r.onSubmit()}),p(8,"ion-item")(9,"ion-label",2),P(10,"Child's Name"),d(),x(11,"ion-input",3),d(),j(12,Bt,2,1),j(13,qt,1,1,"ion-img",4),p(14,"ion-button",5),j(15,Kt,1,0,"ion-spinner")(16,jt,2,1,"span"),d()()()),i&2&&(C(5),fe("",r.is_edit_mode?"Edit":"Add"," Child"),C(2),M("formGroup",r.addKidForm),C(5),X(r.is_edit_mode==!1||(r.currentKid==null?null:r.currentKid.profile_picture_url)==null?12:-1),C(),X(r.is_edit_mode==!0&&(r.currentKid==null?null:r.currentKid.profile_picture_url)!=null?13:-1),C(),M("disabled",r.addKidForm.invalid||r.loading),C(),X(r.loading?15:16))},dependencies:[Ze,Ne,je,Xe,Ge,$e,ne,st,te,re,oe,ot,et,ie,it,nt,rt,tt,xt],encapsulation:2});let o=e;return o})();export{Ei as KidFormPage};
